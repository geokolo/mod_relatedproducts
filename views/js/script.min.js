/**
 * Copyright since 2007 PrestaShop SA and Contributors
 * PrestaShop is an International Registered Trademark & Property of PrestaShop SA
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License 3.0 (AFL-3.0)
 * that is bundled with this package in the file LICENSE.md.
 * It is also available through the world-wide-web at this URL:
 * https://opensource.org/licenses/AFL-3.0
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@prestashop.com so we can send you a copy immediately.
 *
* @author    GeoKolo
* @copyright GeoKolo
* @license   https://opensource.org/licenses/AFL-3.0 Academic Free License 3.0 (AFL-3.0)
*/

!function(t){t.fn.skRelatedProduct=function(){var e=t(this),n=e.attr("ajax-link")||null,i=e.attr("ajax-remote_url")||null,a=e.attr("id-product")||0,r="undefined"!=typeof update_success_msg?update_success_msg:"Updated successfully!";e.find(".related_product tbody").sortable({stop:function(i,d){var o=new Array;e.find('input[name="related_product_input[]"]').each(function(e){o.push(t(this).val())}),o.length&&t.post(n,{id_product:a,related_ids:o,action:"UpdatePositions"},function(t){"Ok"===t&&showSuccessMessage(r)})}}),e.find(".related_product tbody").disableSelection();var d=e.find("#row_template");e.find("#row_template").remove();var o=function(e,i){var o=d.clone().removeAttr("id");o.find("td").eq(1).text(e),o.find("td").eq(2).text(i),o.find('input[name="related_product_input[]"]').val(e),o.appendTo(".related_product tbody"),t.post(n,{id_product:a,id_related:e,action:"AddProduct"},function(t){"Ok"===t&&showSuccessMessage(r)})};e.find("input[name=product_autocomplete_input]").keyup(function(){var n=t.trim(t(this).val()),r=new Array;r.push(a),e.find('input[name="related_product_input[]"]').each(function(e){r.push(t(this).val())}),n.length?t.post(i,{q:n,limit:20,excludeIds:r.join()},function(n){e.find(".ajax_result").html("").hide();for(var i=n.split("\n"),a=0;a<i.length-1;a++){var r=i[a].lastIndexOf("|"),d=i[a].substr(0,r).trim(),u=i[a].slice(r+1,i[a].length).trim(),s=t("<a>").attr("rel",u).attr("title",d).attr("href","javascript:void(0);");s.html("<span>"+u+". "+d+"</span></a>"),s.appendTo(e.find(".ajax_result").show()),s.click(function(e){e.preventDefault(),o(t(this).attr("rel"),t(this).attr("title"))})}}):e.find(".ajax_result").html("").hide()}),e.find("input[name=product_autocomplete_input]").blur(function(){t(this).val(""),setTimeout(function(){e.find(".ajax_result").hide()},200)}),e.on("click",".delete_product_related",function(e){if(e.preventDefault(),e.stopPropagation(),confirm(confirm_delete_related)){var i=t(this).closest("tr").find('input[name="related_product_input[]"]').val();t(this).closest("tr").remove(),t.post(n,{id_product:a,id_related:i,action:"DeleteProduct"},function(t){"Ok"===t&&showSuccessMessage(r)})}})}}(jQuery);
